{% extends 'common/__form_base.html' %}
{% load mytags %}
{% block body_block %}
    <body onload="initialize()">
{% endblock %}
{% block form_header %}
{% include "common/mainheader_nograph.html" with icon="fa fa-group" title="Create Estimate" subtitle="Create Estimate" %}
{% endblock %}
{% block h4_block %}Create Estimate{% endblock h4_block %}
{% block form_breadcrumb %}
<!-- breadcrumb -->
<div class="container padded">
    <div class="row">
      <div id="breadcrumbs">
        <div class="breadcrumb-button blue">
          <span class="breadcrumb-label"><i class="icon-home"></i> Home</span>
          <span class="breadcrumb-arrow"><span></span></span>
        </div>
        <div class="breadcrumb-button">
          <span class="breadcrumb-label">
            <i class="fa fa-group"></i>
              <a href="/equipment/index/">Equipment Home</a>
          </span>
          <span class="breadcrumb-arrow"><span></span></span>
        </div>
        <div class="breadcrumb-button">
            <span class="breadcrumb-label">
                <i class="fa fa-phone"></i>
                Add Part
            </span>
        </div>
      </div>
    </div>
</div> <!-- container padded -->
{% endblock form_breadcrumb %}
{% block form_content %}
    <script>
//        $(document).ready(function() {
//            $("#id_part_id").change(function () {
//                alert('Handler for .change() called');
//            });
//        });
//        $(document).ready(function() {
//            $("#id_quantity").change(function () {
//                alert('Handler for .change() called');
//            });
//        });

        $(document).ready(function() {
            $("#id_quantity").change(function(){
                var cost = $("#idCost").text();
                var flat = $("#idFlat").text();
                var labor = $("#idLabor").text();
                var margin = .40;
                var qty = $("#id_quantity").text();
                var estCost = cost * qty;
                $("#id_cost").val(cost * qty);
                var finalCost = (cost/1-margin);
                $("#id_final_cost").innerHTML = finalCost;
                var subTotal = finalCost * qty;
                $("#id_sub_total").innerHTML = subTotal
                $("#id_profit").innerHTML = subTotal - estCost;
                $("#id_total_hours").innerHTML = qty * labor;
                alert(cost + ' ' + qty + ' ' +  flat + ' ' + (cost * qty));
            });
        });
    </script>
    {% for i in form0 %}
        <li>
            <label>{{ i.label|title|cut:"_" }}</label>
            {% if i.name = 'estimate_id' %}
                {{ i }}
                <strong>
                    Margin: <span id="idMargin">{{ estimate.margin }}%</span>
                    {{estimate_parts_client}}
                    {{ object }}
                </strong>
            {% elif i.name = 'part_id' %}
                {{ i }}
                <strong>
                Cost: $<span id="idCost">0</span><br/>
                Flat: $<span id="idFlat">0</span><br/>
                Labor: <span id="idLabor">0</span> hrs.<br/>
                </strong>
            {% else %}
                {{ i }}
            {% endif %}
        </li>
    {% endfor %}
    {% if estimate %}
        {{ estimate }}
    {% else %}
        No estimate
    {% endif %}
{% endblock %}